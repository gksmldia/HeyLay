<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.planb.statics.dao.StaticsDAO">
	
	<select id="selectSavedSource" parameterType="int" resultType="staticsVO">
		SELECT r.sourceName columnName, COUNT(r.sourceName) cnt 
		FROM (SELECT so.name as sourceName 
		FROM q_contents_saved cs 
		INNER JOIN q_contents co ON co.no = cs.contents_no 
		INNER JOIN q_source so ON so.no = co.source_no 
		WHERE cs.member_no = #{ no }) r 
		GROUP BY r.sourceName 
		ORDER BY cnt DESC 
	</select>
	
	<select id="selectSourceType" parameterType="int" resultType="staticsVO">
		SELECT r.dataType columnName, COUNT(r.dataType) cnt 
		FROM (SELECT dt.data_type as dataType 
		FROM q_contents_saved cs 
		INNER JOIN q_contents co ON co.no = cs.contents_no 
		INNER JOIN q_source so ON so.no = co.source_no 
		INNER JOIN q_data_type dt ON dt.no = so.data_type 
		WHERE cs.member_no = #{ no }) r 
		GROUP BY r.dataType 
		ORDER BY cnt DESC 
	</select>
	
    <select id="selectWordCloudList" parameterType="int" resultType="staticsVO">
		SELECT keyword as columnName, COUNT(keyword) as cnt 
			FROM Q_KEYWORDS
		WHERE MEMBER_NO = #{ memberNo }
		GROUP BY keyword
		ORDER BY cnt DESC 
	</select> 
	
	<select id="selectAllUserWordCloudList" parameterType="staticsVO" resultType="staticsVO">
		SELECT keyword as columnName, COUNT(keyword) as cnt 
		FROM Q_KEYWORDS
		GROUP BY keyword
		ORDER BY cnt DESC 
	</select>
	
	<select id="selectAllSavedSource" parameterType="int" resultType="staticsVO">
		SELECT r.sourceName columnName, COUNT(r.sourceName) cnt 
		FROM (SELECT so.name as sourceName 
		FROM q_contents_saved cs 
		INNER JOIN q_contents co ON co.no = cs.contents_no 
		INNER JOIN q_source so ON so.no = co.source_no) r 
		GROUP BY r.sourceName 
		ORDER BY cnt DESC 
	</select>
	
	<select id="selectAllSourceType" parameterType="int" resultType="staticsVO">
		SELECT r.dataType columnName, COUNT(r.dataType) cnt 
		FROM (SELECT dt.data_type as dataType 
		FROM q_contents_saved cs 
		INNER JOIN q_contents co ON co.no = cs.contents_no 
		INNER JOIN q_source so ON so.no = co.source_no 
		INNER JOIN q_data_type dt ON dt.no = so.data_type) r 
		GROUP BY r.dataType 
		ORDER BY cnt DESC 
	</select>

</mapper>